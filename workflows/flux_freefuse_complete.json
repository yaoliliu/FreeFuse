{
  "id": "45e5cd8d-ee5d-4dd8-a8cd-2b44dd243280",
  "revision": 0,
  "last_node_id": 101,
  "last_link_id": 50,
  "nodes": [
    {
      "id": 100,
      "type": "Note",
      "pos": [
        -700,
        50
      ],
      "size": [
        700,
        1100
      ],
      "flags": {},
      "order": 0,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "text": ""
      },
      "widgets_values": [
        "# FreeFuse Flux â€” Model & LoRA Download Guide\n# FreeFuse Flux â€” æ¨¡å‹ä¸LoRAä¸‹è½½æŒ‡å—\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## Required Models / æ‰€éœ€æ¨¡å‹ (FP8 Quantized)\n\n### ğŸ“‚ text_encoders/\nâ€¢ clip_l.safetensors\n  â†’ https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors\n  EN: CLIP-L text encoder\n  ä¸­: CLIP-L æ–‡æœ¬ç¼–ç å™¨\n\nâ€¢ t5xxl_fp8_e4m3fn.safetensors\n  â†’ https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn.safetensors\n  EN: T5-XXL text encoder (FP8 quantized)\n  ä¸­: T5-XXL æ–‡æœ¬ç¼–ç å™¨ï¼ˆFP8é‡åŒ–ï¼‰\n\n### ğŸ“‚ diffusion_models/\nâ€¢ flux1-dev-fp8.safetensors\n  â†’ https://huggingface.co/Comfy-Org/flux1-dev/resolve/main/flux1-dev-fp8.safetensors\n  EN: Flux.1 Dev transformer (FP8 quantized)\n  ä¸­: Flux.1 Dev å˜æ¢å™¨æ¨¡å‹ï¼ˆFP8é‡åŒ–ï¼‰\n\n### ğŸ“‚ vae/\nâ€¢ ae.safetensors\n  â†’ https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/resolve/main/split_files/vae/ae.safetensors\n  EN: Flux VAE autoencoder\n  ä¸­: Flux VAE è‡ªç¼–ç å™¨\n\n### ğŸ“‚ loras/ (LoRA Files)\nâ€¢ harry_potter_flux.safetensors\n  â†’ https://huggingface.co/lsmpp/freefuse_community_loras/resolve/main/harry_potter.safetensors\nâ€¢ daiyu_lin_flux.safetensors\n  â†’ https://huggingface.co/lsmpp/freefuse_community_loras/resolve/main/daiyu_lin.safetensors\n  EN: Download and rename to *_flux.safetensors, or change lora_name in nodes\n  ä¸­: ä¸‹è½½åé‡å‘½åä¸º *_flux.safetensorsï¼Œæˆ–ä¿®æ”¹èŠ‚ç‚¹ä¸­çš„ lora_name\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## Directory Structure / ç›®å½•ç»“æ„\nğŸ“‚ ComfyUI/models/\nâ”œâ”€ text_encoders/\nâ”‚  â”œâ”€ clip_l.safetensors\nâ”‚  â””â”€ t5xxl_fp8_e4m3fn.safetensors\nâ”œâ”€ diffusion_models/\nâ”‚  â””â”€ flux1-dev-fp8.safetensors\nâ”œâ”€ vae/\nâ”‚  â””â”€ ae.safetensors\nâ””â”€ loras/\n   â”œâ”€ harry_potter_flux.safetensors\n   â””â”€ daiyu_lin_flux.safetensors\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## Important Notes / é‡è¦æç¤º\nâ€¢ FP8 uses ~50% less VRAM than FP16 / FP8çº¦çœ50%æ˜¾å­˜\nâ€¢ ~12GB VRAM for 1024Ã—1024 / çº¦éœ€12GBæ˜¾å­˜\nâ€¢ Flux uses guidance embedding, NOT CFG / Fluxç”¨guidanceåµŒå…¥è€ŒéCFG\nâ€¢ KSampler CFG must be 1.0 for Flux / KSampler CFGå¿…é¡»ä¸º1.0\nâ€¢ Guidance set in CLIPTextEncodeFlux (default 3.5)\n  å¼•å¯¼å€¼åœ¨CLIPTextEncodeFluxä¸­è®¾ç½®ï¼ˆé»˜è®¤3.5ï¼‰\nâ€¢ For full precision, use FP16 model variants\n  å¦‚éœ€å…¨ç²¾åº¦ï¼Œä½¿ç”¨FP16æ¨¡å‹å˜ä½“"
      ],
      "color": "#432",
      "bgcolor": "#653"
    },
    {
      "id": 1,
      "type": "UNETLoader",
      "pos": [
        50,
        100
      ],
      "size": [
        315,
        82
      ],
      "flags": {},
      "order": 1,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "MODEL",
          "type": "MODEL",
          "slot_index": 0,
          "links": [
            1
          ]
        }
      ],
      "title": "Load Flux UNET",
      "properties": {
        "Node name for S&R": "UNETLoader",
        "cnr_id": "comfy-core",
        "models": [
          {
            "name": "flux1-dev-fp8.safetensors",
            "url": "https://huggingface.co/Comfy-Org/flux1-dev/resolve/main/flux1-dev-fp8.safetensors",
            "directory": "diffusion_models"
          }
        ]
      },
      "widgets_values": [
        "flux1-dev-fp8.safetensors",
        "fp8_e4m3fn"
      ]
    },
    {
      "id": 2,
      "type": "DualCLIPLoader",
      "pos": [
        50,
        250
      ],
      "size": [
        315,
        130
      ],
      "flags": {},
      "order": 2,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "CLIP",
          "type": "CLIP",
          "slot_index": 0,
          "links": [
            2
          ]
        }
      ],
      "title": "Load CLIP + T5",
      "properties": {
        "Node name for S&R": "DualCLIPLoader",
        "cnr_id": "comfy-core",
        "models": [
          {
            "name": "clip_l.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors",
            "directory": "text_encoders"
          },
          {
            "name": "t5xxl_fp8_e4m3fn.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn.safetensors",
            "directory": "text_encoders"
          }
        ]
      },
      "widgets_values": [
        "clip_l.safetensors",
        "t5xxl_fp8_e4m3fn.safetensors",
        "flux",
        "default"
      ]
    },
    {
      "id": 3,
      "type": "VAELoader",
      "pos": [
        50,
        450
      ],
      "size": [
        315,
        58
      ],
      "flags": {},
      "order": 3,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "VAE",
          "type": "VAE",
          "slot_index": 0,
          "links": [
            30
          ]
        }
      ],
      "title": "Load Flux VAE",
      "properties": {
        "Node name for S&R": "VAELoader",
        "cnr_id": "comfy-core",
        "models": [
          {
            "name": "ae.safetensors",
            "url": "https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/resolve/main/split_files/vae/ae.safetensors",
            "directory": "vae"
          }
        ]
      },
      "widgets_values": [
        "ae.safetensors"
      ]
    },
    {
      "id": 4,
      "type": "FreeFuseLoRALoader",
      "pos": [
        450,
        100
      ],
      "size": [
        315,
        170
      ],
      "flags": {},
      "order": 7,
      "mode": 0,
      "inputs": [
        {
          "name": "model",
          "type": "MODEL",
          "link": 1
        },
        {
          "name": "clip",
          "type": "CLIP",
          "link": 2
        },
        {
          "name": "freefuse_data",
          "shape": 7,
          "type": "FREEFUSE_DATA",
          "link": null
        }
      ],
      "outputs": [
        {
          "name": "model",
          "type": "MODEL",
          "slot_index": 0,
          "links": [
            3
          ]
        },
        {
          "name": "clip",
          "type": "CLIP",
          "slot_index": 1,
          "links": [
            4
          ]
        },
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "slot_index": 2,
          "links": [
            5
          ]
        }
      ],
      "title": "LoRA 1: Harry Potter",
      "properties": {
        "Node name for S&R": "FreeFuseLoRALoader"
      },
      "widgets_values": [
        "harry_potter_flux.safetensors",
        "harry",
        1,
        1
      ]
    },
    {
      "id": 5,
      "type": "FreeFuseLoRALoader",
      "pos": [
        450,
        320
      ],
      "size": [
        315,
        170
      ],
      "flags": {},
      "order": 8,
      "mode": 0,
      "inputs": [
        {
          "name": "model",
          "type": "MODEL",
          "link": 3
        },
        {
          "name": "clip",
          "type": "CLIP",
          "link": 4
        },
        {
          "name": "freefuse_data",
          "shape": 7,
          "type": "FREEFUSE_DATA",
          "link": 5
        }
      ],
      "outputs": [
        {
          "name": "model",
          "type": "MODEL",
          "slot_index": 0,
          "links": [
            6
          ]
        },
        {
          "name": "clip",
          "type": "CLIP",
          "slot_index": 1,
          "links": [
            7,
            8,
            9
          ]
        },
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "slot_index": 2,
          "links": [
            10
          ]
        }
      ],
      "title": "LoRA 2: Daiyu Lin",
      "properties": {
        "Node name for S&R": "FreeFuseLoRALoader"
      },
      "widgets_values": [
        "daiyu_lin_flux.safetensors",
        "daiyu",
        1,
        1
      ]
    },
    {
      "id": 6,
      "type": "FreeFuseConceptMap",
      "pos": [
        850,
        100
      ],
      "size": [
        380,
        424.0000000000001
      ],
      "flags": {},
      "order": 11,
      "mode": 0,
      "inputs": [
        {
          "name": "freefuse_data",
          "shape": 7,
          "type": "FREEFUSE_DATA",
          "link": 10
        }
      ],
      "outputs": [
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "slot_index": 0,
          "links": [
            11
          ]
        }
      ],
      "title": "Concept Mapping",
      "properties": {
        "Node name for S&R": "FreeFuseConceptMap"
      },
      "widgets_values": [
        "harry",
        "harry potter, an European photorealistic style teenage wizard boy with messy black hair, round wire-frame glasses, and bright green eyes, wearing a white shirt, burgundy and gold striped tie, and dark robes",
        "daiyu",
        "daiyu_lin, a young East Asian photorealistic style woman in traditional Chinese hanfu dress, elaborate black updo hairstyle adorned with delicate white floral hairpins and ornaments, dangling red tassel earrings, soft pink and red color palette, gentle smile with knowing expression",
        "",
        "",
        "",
        "",
        true,
        "autumn leaves blurred in the background"
      ]
    },
    {
      "id": 20,
      "type": "PrimitiveNode",
      "pos": [
        850,
        500
      ],
      "size": [
        380,
        130
      ],
      "flags": {},
      "order": 4,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "STRING",
          "type": "STRING",
          "widget": {
            "name": "prompt"
          },
          "slot_index": 0,
          "links": [
            35,
            36,
            37
          ]
        }
      ],
      "title": "Main Prompt",
      "properties": {
        "Run widget replace on values": false
      },
      "widgets_values": [
        "Realistic photography, harry potter, an European photorealistic style teenage wizard boy with messy black hair, round wire-frame glasses, and bright green eyes, wearing a white shirt, burgundy and gold striped tie, and dark robes hugging daiyu_lin, a young East Asian photorealistic style woman in traditional Chinese hanfu dress, elaborate black updo hairstyle adorned with delicate white floral hairpins and ornaments, dangling red tassel earrings, soft pink and red color palette, gentle smile with knowing expression, autumn leaves blurred in the background, high quality, detailed"
      ]
    },
    {
      "id": 8,
      "type": "FreeFuseTokenPositions",
      "pos": [
        1320,
        100
      ],
      "size": [
        340,
        156
      ],
      "flags": {},
      "order": 12,
      "mode": 0,
      "inputs": [
        {
          "name": "clip",
          "type": "CLIP",
          "link": 7
        },
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "link": 11
        },
        {
          "name": "prompt",
          "type": "STRING",
          "widget": {
            "name": "prompt"
          },
          "link": 35
        }
      ],
      "outputs": [
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "slot_index": 0,
          "links": [
            14
          ]
        }
      ],
      "title": "Compute Token Positions",
      "properties": {
        "Node name for S&R": "FreeFuseTokenPositions"
      },
      "widgets_values": [
        "Realistic photography, harry potter, an European photorealistic style teenage wizard boy with messy black hair, round wire-frame glasses, and bright green eyes, wearing a white shirt, burgundy and gold striped tie, and dark robes hugging daiyu_lin, a young East Asian photorealistic style woman in traditional Chinese hanfu dress, elaborate black updo hairstyle adorned with delicate white floral hairpins and ornaments, dangling red tassel earrings, soft pink and red color palette, gentle smile with knowing expression, autumn leaves blurred in the background, high quality, detailed",
        true,
        true
      ]
    },
    {
      "id": 9,
      "type": "CLIPTextEncodeFlux",
      "pos": [
        1320,
        280
      ],
      "size": [
        340,
        166
      ],
      "flags": {},
      "order": 9,
      "mode": 0,
      "inputs": [
        {
          "name": "clip",
          "type": "CLIP",
          "link": 8
        },
        {
          "name": "clip_l",
          "type": "STRING",
          "widget": {
            "name": "clip_l"
          },
          "link": 36
        },
        {
          "name": "t5xxl",
          "type": "STRING",
          "widget": {
            "name": "t5xxl"
          },
          "link": 37
        }
      ],
      "outputs": [
        {
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            16,
            28
          ]
        }
      ],
      "title": "Positive Conditioning",
      "properties": {
        "Node name for S&R": "CLIPTextEncodeFlux"
      },
      "widgets_values": [
        "Realistic photography, harry potter, an European photorealistic style teenage wizard boy with messy black hair, round wire-frame glasses, and bright green eyes, wearing a white shirt, burgundy and gold striped tie, and dark robes hugging daiyu_lin, a young East Asian photorealistic style woman in traditional Chinese hanfu dress, elaborate black updo hairstyle adorned with delicate white floral hairpins and ornaments, dangling red tassel earrings, soft pink and red color palette, gentle smile with knowing expression, autumn leaves blurred in the background, high quality, detailed",
        "Realistic photography, harry potter, an European photorealistic style teenage wizard boy with messy black hair, round wire-frame glasses, and bright green eyes, wearing a white shirt, burgundy and gold striped tie, and dark robes hugging daiyu_lin, a young East Asian photorealistic style woman in traditional Chinese hanfu dress, elaborate black updo hairstyle adorned with delicate white floral hairpins and ornaments, dangling red tassel earrings, soft pink and red color palette, gentle smile with knowing expression, autumn leaves blurred in the background, high quality, detailed",
        3.5
      ]
    },
    {
      "id": 13,
      "type": "PreviewImage",
      "pos": [
        2220,
        100
      ],
      "size": [
        320,
        280
      ],
      "flags": {},
      "order": 15,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 21
        }
      ],
      "outputs": [],
      "title": "Phase 1 Mask Preview",
      "properties": {
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 15,
      "type": "FreeFuseMaskPreview",
      "pos": [
        2220,
        420
      ],
      "size": [
        320,
        150
      ],
      "flags": {},
      "order": 14,
      "mode": 0,
      "inputs": [
        {
          "name": "masks",
          "type": "FREEFUSE_MASKS",
          "link": 20
        }
      ],
      "outputs": [
        {
          "name": "combined_preview",
          "type": "IMAGE",
          "slot_index": 0,
          "links": [
            40
          ]
        },
        {
          "name": "individual_masks",
          "type": "IMAGE",
          "slot_index": 1,
          "links": [
            41
          ]
        }
      ],
      "title": "Detailed Mask Preview",
      "properties": {
        "Node name for S&R": "FreeFuseMaskPreview"
      },
      "widgets_values": [
        512,
        512,
        true,
        true
      ]
    },
    {
      "id": 25,
      "type": "PreviewImage",
      "pos": [
        2600,
        420
      ],
      "size": [
        260,
        246
      ],
      "flags": {},
      "order": 16,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 40
        }
      ],
      "outputs": [],
      "title": "Combined Masks",
      "properties": {
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 26,
      "type": "PreviewImage",
      "pos": [
        2600,
        680
      ],
      "size": [
        260,
        246
      ],
      "flags": {},
      "order": 17,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 41
        }
      ],
      "outputs": [],
      "title": "Individual Masks",
      "properties": {
        "Node name for S&R": "PreviewImage"
      },
      "widgets_values": []
    },
    {
      "id": 14,
      "type": "FreeFuseMaskApplicator",
      "pos": [
        1753.1380528702302,
        881.355366001827
      ],
      "size": [
        380,
        320
      ],
      "flags": {},
      "order": 18,
      "mode": 0,
      "inputs": [
        {
          "name": "model",
          "type": "MODEL",
          "link": 18
        },
        {
          "name": "masks",
          "type": "FREEFUSE_MASKS",
          "link": 19
        },
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "link": 14
        },
        {
          "name": "latent",
          "shape": 7,
          "type": "LATENT",
          "link": 22
        }
      ],
      "outputs": [
        {
          "name": "model",
          "type": "MODEL",
          "slot_index": 0,
          "links": [
            23
          ]
        }
      ],
      "title": "Phase 2: Apply Masks",
      "properties": {
        "Node name for S&R": "FreeFuseMaskApplicator"
      },
      "widgets_values": [
        true,
        true,
        5,
        1,
        true,
        true,
        "all"
      ]
    },
    {
      "id": 16,
      "type": "KSampler",
      "pos": [
        1753.1380528702302,
        1281.3553660018272
      ],
      "size": [
        380,
        350
      ],
      "flags": {},
      "order": 19,
      "mode": 0,
      "inputs": [
        {
          "name": "model",
          "type": "MODEL",
          "link": 23
        },
        {
          "name": "positive",
          "type": "CONDITIONING",
          "link": 28
        },
        {
          "name": "negative",
          "type": "CONDITIONING",
          "link": 39
        },
        {
          "name": "latent_image",
          "type": "LATENT",
          "link": 50
        }
      ],
      "outputs": [
        {
          "name": "LATENT",
          "type": "LATENT",
          "slot_index": 0,
          "links": [
            24
          ]
        }
      ],
      "title": "Phase 2: Full Generation",
      "properties": {
        "Node name for S&R": "KSampler"
      },
      "widgets_values": [
        42,
        "fixed",
        28,
        1,
        "euler",
        "simple",
        1
      ]
    },
    {
      "id": 17,
      "type": "VAEDecode",
      "pos": [
        2220,
        1050
      ],
      "size": [
        200,
        50
      ],
      "flags": {},
      "order": 20,
      "mode": 0,
      "inputs": [
        {
          "name": "samples",
          "type": "LATENT",
          "link": 24
        },
        {
          "name": "vae",
          "type": "VAE",
          "link": 30
        }
      ],
      "outputs": [
        {
          "name": "IMAGE",
          "type": "IMAGE",
          "slot_index": 0,
          "links": [
            26
          ]
        }
      ],
      "properties": {
        "Node name for S&R": "VAEDecode"
      },
      "widgets_values": []
    },
    {
      "id": 18,
      "type": "SaveImage",
      "pos": [
        2500,
        950
      ],
      "size": [
        400,
        400
      ],
      "flags": {},
      "order": 21,
      "mode": 0,
      "inputs": [
        {
          "name": "images",
          "type": "IMAGE",
          "link": 26
        }
      ],
      "outputs": [],
      "title": "Final Output",
      "properties": {
        "Node name for S&R": "SaveImage"
      },
      "widgets_values": [
        "FreeFuse/flux_output"
      ]
    },
    {
      "id": 101,
      "type": "Note",
      "pos": [
        -694.8444062850768,
        1195.91015625
      ],
      "size": [
        700,
        2200
      ],
      "flags": {},
      "order": 5,
      "mode": 0,
      "inputs": [],
      "outputs": [],
      "properties": {
        "text": ""
      },
      "widgets_values": [
        "# FreeFuse Flux â€” Complete Parameter Guide\n# FreeFuse Flux â€” å®Œæ•´å‚æ•°æŒ‡å—\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## Workflow Overview / å·¥ä½œæµæ¦‚è§ˆ\nEN: FreeFuse uses a two-phase approach for multi-LoRA composition:\n  Phase 1: Collect cross-attention â†’ generate spatial masks\n  Phase 2: Apply masks to LoRAs â†’ full denoising generation\nä¸­: FreeFuse é‡‡ç”¨ä¸¤é˜¶æ®µæ–¹æ³•å®ç°å¤šLoRAåˆæˆï¼š\n  é˜¶æ®µ1ï¼šæ”¶é›†äº¤å‰æ³¨æ„åŠ› â†’ ç”Ÿæˆç©ºé—´æ©ç \n  é˜¶æ®µ2ï¼šå¯¹LoRAåº”ç”¨æ©ç  â†’ å®Œæ•´å»å™ªç”Ÿæˆ\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## 1. LoRA Loader / LoRAåŠ è½½å™¨\nâ€¢ adapter_name (string): Unique ID, MUST match ConceptMap\n  é€‚é…å™¨åç§°ï¼šå¿…é¡»ä¸ConceptMapä¸­ä¸€è‡´\nâ€¢ strength_model (float, default=1.0): LoRA strength for transformer\n  å˜æ¢å™¨çš„LoRAå¼ºåº¦\nâ€¢ strength_clip (float, default=1.0): LoRA strength for text encoder\n  æ–‡æœ¬ç¼–ç å™¨çš„LoRAå¼ºåº¦\n\n## 2. Concept Map / æ¦‚å¿µæ˜ å°„\nâ€¢ concept_text: Description text for this concept\n  MUST appear verbatim in prompt\n  æ¦‚å¿µæ–‡æœ¬ï¼šå¿…é¡»åŸæ ·å‡ºç°åœ¨æç¤ºè¯ä¸­\nâ€¢ enable_background (bool, default=true): Background as separate concept\n  å°†èƒŒæ™¯ä½œä¸ºç‹¬ç«‹æ¦‚å¿µå¤„ç†\nâ€¢ background_text (string): Background description (optional)\n  èƒŒæ™¯æè¿°ï¼ˆå¯é€‰ï¼Œç•™ç©ºåˆ™è‡ªåŠ¨æ£€æµ‹ï¼‰\n\n## 3. Token Positions / Tokenä½ç½®\nâ€¢ filter_meaningless (bool, default=true): Remove articles/prepositions\n  è¿‡æ»¤å† è¯/ä»‹è¯ç­‰æ— æ„ä¹‰è¯\nâ€¢ filter_single_char (bool, default=true): Remove single-char tokens\n  è¿‡æ»¤å•å­—ç¬¦token\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## 4. Phase 1 Sampler / é˜¶æ®µ1é‡‡æ ·å™¨\n\n### Core Parameters / æ ¸å¿ƒå‚æ•°\nâ€¢ steps (int, default=28): Total steps, MUST match Phase 2\n  æ€»æ­¥æ•°ï¼šé¡»ä¸é˜¶æ®µ2ä¸€è‡´\nâ€¢ collect_step (int, default=5): Collect attention then early-stop\n  æ”¶é›†æ³¨æ„åŠ›åæå‰ç»ˆæ­¢çš„æ­¥éª¤\nâ€¢ cfg (float, default=1.0): Flux MUST be 1.0\n  (guidance via CLIPTextEncodeFlux)\n  Fluxå¿…é¡»1.0ï¼ˆå¼•å¯¼é€šè¿‡ç¼–ç å™¨è®¾ç½®ï¼‰\nâ€¢ sampler_name: euler recommended for Flux\n  Fluxæ¨èeuler\nâ€¢ scheduler: simple recommended for Flux\n  Fluxæ¨èsimple\n\n### Block Selection [Flux] / Blocké€‰æ‹©\nâ€¢ collect_block (int, default=18): Double-block 0-56\n  åŒæµblockç´¢å¼•0-56ç”¨äºæ³¨æ„åŠ›æ”¶é›†\n  â˜… Block 18 recommended / æ¨èBlock 18\nâ€¢ collect_region: [SDXL only, ignored for Flux]\n  [ä»…SDXLï¼ŒFluxå¿½ç•¥æ­¤å‚æ•°]\nâ€¢ collect_tf_index: [SDXL only, ignored for Flux]\n  [ä»…SDXLï¼ŒFluxå¿½ç•¥æ­¤å‚æ•°]\n\n### Similarity / ç›¸ä¼¼åº¦è®¡ç®—\nâ€¢ temperature (float, default=0â†’auto:4000):\n  Softmax temperature. Higher = sharper maps\n  Softmaxæ¸©åº¦ï¼Œè¶Šé«˜â†’è¶Šé”åˆ©çš„æ˜ å°„\nâ€¢ top_k_ratio (float, default=0.3):\n  Ratio of top-k tokens for similarity\n  top-k tokenæ¯”ä¾‹\n\n### LoRA Control / LoRAæ§åˆ¶\nâ€¢ disable_lora_phase1 (bool, default=true â˜…):\n  Disable LoRA for cleaner base-model attention\n  ç¦ç”¨LoRAä»¥è·å–æ›´å¹²å‡€çš„æ³¨æ„åŠ› â˜…æ¨è\n\n### Mask Post-processing / æ©ç åå¤„ç†\nâ€¢ bg_scale (float, default=0.95):\n  Background scaling. Higher = more background\n  èƒŒæ™¯ç¼©æ”¾ï¼Œè¶Šé«˜â†’èƒŒæ™¯è¶Šå¤§\nâ€¢ use_morphological_cleaning (bool, default=false):\n  Clean mask boundaries with morphology\n  å½¢æ€å­¦æ¸…ç†æ©ç è¾¹ç•Œ\n\n### Mask Balancing (Advanced) / æ©ç å¹³è¡¡ï¼ˆé«˜çº§ï¼‰\nâ€¢ balance_iterations (int, 15): Balanced argmax iterations\n  å¹³è¡¡argmaxè¿­ä»£æ¬¡æ•°\nâ€¢ balance_lr (float, 0.01): Bias update learning rate\n  åç½®æ›´æ–°å­¦ä¹ ç‡\nâ€¢ gravity_weight (float, 0.00004): Centroid attraction\n  è´¨å¿ƒå¸å¼•åŠ›ï¼ˆç©ºé—´è¿è´¯æ€§ï¼‰\nâ€¢ spatial_weight (float, 0.00004): Neighbor voting\n  é‚»åŸŸæŠ•ç¥¨ï¼ˆç©ºé—´å¹³æ»‘æ€§ï¼‰\nâ€¢ momentum (float, 0.2): Smoothing between iters\n  è¿­ä»£é—´å¹³æ»‘åŠ¨é‡\nâ€¢ centroid_margin (float, 0.0): Clamp from borders\n  è´¨å¿ƒè¾¹ç•Œå¤¹ç´§\nâ€¢ border_penalty (float, 0.0): Border assignment penalty\n  è¾¹ç•Œåˆ†é…æƒ©ç½š\nâ€¢ anisotropy (float, 1.3): H-stretch >1=wider masks\n  å„å‘å¼‚æ€§ >1=æ›´å®½çš„æ©ç \n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## 5. Mask Applicator / æ©ç åº”ç”¨å™¨\n\n### LoRA Masking / LoRAæ©ç \nâ€¢ enable_token_masking (bool, true):\n  Zero LoRA at other concepts' tokens\n  åœ¨å…¶ä»–æ¦‚å¿µtokenå¤„æ¸…é›¶LoRAè¾“å‡º\n\n### Attention Bias / æ³¨æ„åŠ›åç½®\nâ€¢ enable_attention_bias (bool, true):\n  Apply attention bias to guide cross-attention\n  å¯ç”¨æ³¨æ„åŠ›åç½®å¼•å¯¼äº¤å‰æ³¨æ„åŠ›\nâ€¢ bias_scale (float, 5.0): Negative bias strength\n  Suppress cross-LoRA attention (5-10 typical)\n  è´Ÿåç½®å¼ºåº¦ï¼ˆæŠ‘åˆ¶è·¨LoRAæ³¨æ„åŠ›ï¼Œå…¸å‹å€¼5-10ï¼‰\nâ€¢ positive_bias_scale (float, 1.0):\n  Enhance same-LoRA attention\n  æ­£åç½®å¼ºåº¦ï¼ˆå¢å¼ºåŒLoRAæ³¨æ„åŠ›ï¼‰\nâ€¢ bidirectional (bool, true) [Flux only]:\n  Bias both imgâ†’txt and txtâ†’img\n  åŒå‘åç½® [Fluxä¸“ç”¨]\nâ€¢ use_positive_bias (bool, true):\n  Add positive bias for matched pairs\n  ä¸ºåŒ¹é…å¯¹æ·»åŠ æ­£åç½®\nâ€¢ bias_blocks: Which blocks get bias\n  åº”ç”¨åç½®çš„blockèŒƒå›´\n  - all: All blocks / æ‰€æœ‰block\n  - double_stream_only: Double blocks [Flux]\n  - single_stream_only: Single blocks [Flux]\n  - last_half_double: Last half double blocks\n  - none: Disable / ç¦ç”¨\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n## 6. KSampler (Phase 2)\nâ€¢ seed: Same as Phase 1 / ä¸é˜¶æ®µ1ç›¸åŒ\nâ€¢ steps: MUST match Phase 1 (28) / é¡»ä¸€è‡´\nâ€¢ cfg: MUST be 1.0 for Flux / Fluxé¡»1.0\nâ€¢ sampler/scheduler: Match Phase 1 / ä¸é˜¶æ®µ1ä¸€è‡´\nâ€¢ denoise: 1.0 for full generation / å®Œæ•´ç”Ÿæˆ"
      ],
      "color": "#224",
      "bgcolor": "#335"
    },
    {
      "id": 12,
      "type": "FreeFusePhase1Sampler",
      "pos": [
        1750,
        100
      ],
      "size": [
        380,
        666
      ],
      "flags": {},
      "order": 13,
      "mode": 0,
      "inputs": [
        {
          "name": "model",
          "type": "MODEL",
          "link": 6
        },
        {
          "name": "conditioning",
          "type": "CONDITIONING",
          "link": 16
        },
        {
          "name": "neg_conditioning",
          "type": "CONDITIONING",
          "link": 38
        },
        {
          "name": "latent",
          "type": "LATENT",
          "link": 17
        },
        {
          "name": "freefuse_data",
          "type": "FREEFUSE_DATA",
          "link": 14
        }
      ],
      "outputs": [
        {
          "name": "model",
          "type": "MODEL",
          "slot_index": 0,
          "links": [
            18
          ]
        },
        {
          "name": "masks",
          "type": "FREEFUSE_MASKS",
          "slot_index": 1,
          "links": [
            19,
            20
          ]
        },
        {
          "name": "mask_preview",
          "type": "IMAGE",
          "slot_index": 2,
          "links": [
            21
          ]
        }
      ],
      "title": "Phase 1: Collect Masks",
      "properties": {
        "Node name for S&R": "FreeFusePhase1Sampler"
      },
      "widgets_values": [
        42,
        28,
        28,
        5,
        1,
        "euler",
        "simple",
        18,
        "output_early â˜… (recommended)",
        3,
        4000,
        0.1,
        true,
        0.95,
        true,
        15,
        0.01,
        0.0004,
        0.0004,
        0.2,
        0,
        0,
        1.3
      ]
    },
    {
      "id": 10,
      "type": "EmptySD3LatentImage",
      "pos": [
        1320,
        651.2468911968602
      ],
      "size": [
        340,
        106
      ],
      "flags": {},
      "order": 6,
      "mode": 0,
      "inputs": [],
      "outputs": [
        {
          "name": "LATENT",
          "type": "LATENT",
          "slot_index": 0,
          "links": [
            17,
            22,
            50
          ]
        }
      ],
      "title": "Latent Image Size",
      "properties": {
        "Node name for S&R": "EmptySD3LatentImage"
      },
      "widgets_values": [
        1024,
        1024,
        1
      ]
    },
    {
      "id": 11,
      "type": "CLIPTextEncodeFlux",
      "pos": [
        1320.78017412197,
        478.0312149293347
      ],
      "size": [
        340,
        166
      ],
      "flags": {},
      "order": 10,
      "mode": 0,
      "inputs": [
        {
          "name": "clip",
          "type": "CLIP",
          "link": 9
        }
      ],
      "outputs": [
        {
          "name": "CONDITIONING",
          "type": "CONDITIONING",
          "slot_index": 0,
          "links": [
            38,
            39
          ]
        }
      ],
      "title": "Negative Conditioning",
      "properties": {
        "Node name for S&R": "CLIPTextEncodeFlux"
      },
      "widgets_values": [
        "",
        "",
        3.5
      ]
    }
  ],
  "links": [
    [
      1,
      1,
      0,
      4,
      0,
      "MODEL"
    ],
    [
      2,
      2,
      0,
      4,
      1,
      "CLIP"
    ],
    [
      3,
      4,
      0,
      5,
      0,
      "MODEL"
    ],
    [
      4,
      4,
      1,
      5,
      1,
      "CLIP"
    ],
    [
      5,
      4,
      2,
      5,
      2,
      "FREEFUSE_DATA"
    ],
    [
      6,
      5,
      0,
      12,
      0,
      "MODEL"
    ],
    [
      7,
      5,
      1,
      8,
      0,
      "CLIP"
    ],
    [
      8,
      5,
      1,
      9,
      0,
      "CLIP"
    ],
    [
      9,
      5,
      1,
      11,
      0,
      "CLIP"
    ],
    [
      10,
      5,
      2,
      6,
      0,
      "FREEFUSE_DATA"
    ],
    [
      11,
      6,
      0,
      8,
      1,
      "FREEFUSE_DATA"
    ],
    [
      14,
      8,
      0,
      12,
      4,
      "FREEFUSE_DATA"
    ],
    [
      16,
      9,
      0,
      12,
      1,
      "CONDITIONING"
    ],
    [
      17,
      10,
      0,
      12,
      3,
      "LATENT"
    ],
    [
      18,
      12,
      0,
      14,
      0,
      "MODEL"
    ],
    [
      19,
      12,
      1,
      14,
      1,
      "FREEFUSE_MASKS"
    ],
    [
      20,
      12,
      1,
      15,
      0,
      "FREEFUSE_MASKS"
    ],
    [
      21,
      12,
      2,
      13,
      0,
      "IMAGE"
    ],
    [
      22,
      10,
      0,
      14,
      3,
      "LATENT"
    ],
    [
      23,
      14,
      0,
      16,
      0,
      "MODEL"
    ],
    [
      24,
      16,
      0,
      17,
      0,
      "LATENT"
    ],
    [
      26,
      17,
      0,
      18,
      0,
      "IMAGE"
    ],
    [
      28,
      9,
      0,
      16,
      1,
      "CONDITIONING"
    ],
    [
      30,
      3,
      0,
      17,
      1,
      "VAE"
    ],
    [
      35,
      20,
      0,
      8,
      2,
      "STRING"
    ],
    [
      36,
      20,
      0,
      9,
      1,
      "STRING"
    ],
    [
      37,
      20,
      0,
      9,
      2,
      "STRING"
    ],
    [
      38,
      11,
      0,
      12,
      2,
      "CONDITIONING"
    ],
    [
      39,
      11,
      0,
      16,
      2,
      "CONDITIONING"
    ],
    [
      40,
      15,
      0,
      25,
      0,
      "IMAGE"
    ],
    [
      41,
      15,
      1,
      26,
      0,
      "IMAGE"
    ],
    [
      50,
      10,
      0,
      16,
      3,
      "LATENT"
    ]
  ],
  "groups": [
    {
      "id": 1,
      "title": "1. Load Models",
      "bounding": [
        30,
        50,
        380,
        520
      ],
      "color": "#3f789e",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 2,
      "title": "2. Load LoRAs",
      "bounding": [
        430,
        50,
        380,
        480
      ],
      "color": "#2E8B57",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 3,
      "title": "3. Concept Mapping",
      "bounding": [
        830,
        50,
        420,
        620
      ],
      "color": "#88A825",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 4,
      "title": "4. Conditioning",
      "bounding": [
        1300,
        50,
        400,
        700
      ],
      "color": "#DAA520",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 5,
      "title": "5. Phase 1: Masks",
      "bounding": [
        1730,
        50,
        520,
        500
      ],
      "color": "#A8442A",
      "font_size": 24,
      "flags": {}
    },
    {
      "id": 6,
      "title": "6. Phase 2: Generate",
      "bounding": [
        1733.1380528702302,
        831.355366001827,
        520,
        850
      ],
      "color": "#7B3F9E",
      "font_size": 24,
      "flags": {}
    }
  ],
  "config": {},
  "extra": {
    "ds": {
      "scale": 0.6288129863327355,
      "offset": [
        -1025.4246527754556,
        -144.5362040523662
      ]
    },
    "info": {
      "name": "FreeFuse Flux Complete Workflow",
      "description": "Two-phase FreeFuse workflow for Flux model with multi-LoRA composition. Uses DualCLIPLoader for CLIP+T5 (FP8), UNETLoader for Flux transformer (FP8), and CLIPTextEncodeFlux for guidance-conditioned prompts.",
      "author": "FreeFuse Team",
      "version": "3.1",
      "notes": "Flux uses guidance embedding instead of CFG, so KSampler CFG should stay at 1.0. Guidance is provided via CLIPTextEncodeFlux. This workflow uses FP8 quantized models for reduced VRAM usage (~12GB for 1024x1024).",
      "models": {
        "text_encoders": [
          {
            "name": "clip_l.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/clip_l.safetensors"
          },
          {
            "name": "t5xxl_fp8_e4m3fn.safetensors",
            "url": "https://huggingface.co/comfyanonymous/flux_text_encoders/resolve/main/t5xxl_fp8_e4m3fn.safetensors"
          }
        ],
        "diffusion_models": [
          {
            "name": "flux1-dev-fp8.safetensors",
            "url": "https://huggingface.co/Comfy-Org/flux1-dev/resolve/main/flux1-dev-fp8.safetensors"
          }
        ],
        "vae": [
          {
            "name": "ae.safetensors",
            "url": "https://huggingface.co/Comfy-Org/Lumina_Image_2.0_Repackaged/resolve/main/split_files/vae/ae.safetensors"
          }
        ],
        "loras": [
          {
            "name": "harry_potter_flux.safetensors",
            "url": "https://huggingface.co/lsmpp/freefuse_community_loras/resolve/main/harry_potter.safetensors",
            "note": "Download and rename to harry_potter_flux.safetensors"
          },
          {
            "name": "daiyu_lin_flux.safetensors",
            "url": "https://huggingface.co/lsmpp/freefuse_community_loras/resolve/main/daiyu_lin.safetensors",
            "note": "Download and rename to daiyu_lin_flux.safetensors"
          }
        ]
      }
    },
    "workflowRendererVersion": "LG",
    "frontendVersion": "1.37.11"
  },
  "version": 0.4
}